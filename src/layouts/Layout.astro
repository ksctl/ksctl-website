---
import AppFooter from "../components/AppFooter.astro";
import AppHeader from "../components/AppHeader.astro";

const { title = "ksctl - Strive towards Fast, Efficient and Sustainable Computing" } = Astro.props;
---

<!doctype html>
<html lang="en" class="dark scroll-smooth" x-data="{ darkMode: true }">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <meta
      name="description"
      content="Strive towards Fast, Efficient and Sustainable Computing"
    />
    <title>{title}</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Urbanist:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Brevo Form Styles -->
    <style>
      /* Override Brevo default styles */
      #sib-container,
      .sib-container--large,
      .sib-container--vertical,
      .sib-form-container {
        background: transparent !important;
        border: none !important;
        padding: 0 !important;
        box-shadow: none !important;
      }

      #sib-container input:-ms-input-placeholder {
        text-align: left;
        font-family: 'Inter', Helvetica, sans-serif;
        color: #9ca3af;
      }
      #sib-container input::placeholder {
        text-align: left;
        font-family: 'Inter', Helvetica, sans-serif;
        color: #9ca3af;
      }
      #sib-container textarea::placeholder {
        text-align: left;
        font-family: 'Inter', Helvetica, sans-serif;
        color: #9ca3af;
      }

      .sib-form-block__button .sib-hide-loader-icon {
        display: none !important;
      }
      .sib-form-block__button .sib-show-loader-icon {
        display: inline-block !important;
      }
      .sib-form-block__button[data-loading="true"] .sib-hide-loader-icon {
        display: inline-block !important;
      }
      .sib-form-block__button[data-loading="true"] .sib-form-block__button-text {
        display: none !important;
      }

      /* Style error and success messages */
      .sib-form-message-panel {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 16px;
        display: flex;
        align-items: start;
        gap: 8px;
      }

      #error-message {
        background-color: rgba(254, 226, 226, 0.5);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #991b1b;
      }

      .dark #error-message {
        background-color: rgba(127, 29, 29, 0.2);
        border-color: rgba(239, 68, 68, 0.3);
        color: #fca5a5;
      }

      #success-message {
        background-color: rgba(220, 252, 231, 0.5);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: #166534;
      }

      .dark #success-message {
        background-color: rgba(20, 83, 45, 0.2);
        border-color: rgba(34, 197, 94, 0.3);
        color: #86efac;
      }

      .sib-form-message-panel[style*="display: block"],
      .sib-form-message-panel[style*="display:block"] {
        display: flex !important;
      }
    </style>

    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7PBL3S9S8W"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7PBL3S9S8W');
  </script>
  <body class="bg-white dark:bg-gray-900 font-['Inter',sans-serif] antialiased">
      <AppHeader />
      <slot />
      <AppFooter />
    
      <!-- Back to top button -->
      <div class="fixed bottom-8 right-8 z-40 opacity-0 transition-opacity duration-300" id="backToTop">
        <button 
          onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
          class="flex items-center justify-center w-12 h-12 rounded-full bg-primary/90 hover:bg-primary text-white shadow-lg hover:shadow-xl shadow-primary/20 hover:shadow-primary/40 transition-all hover:-translate-y-1"
          aria-label="Back to top"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
          </svg>
        </button>
      </div>
    
      <style>
        :root {
          --font-heading: 'Urbanist', sans-serif;
          --font-body: 'Inter', sans-serif;
        }
      
        html {
          scroll-behavior: smooth;
          font-family: var(--font-body);
        }

        body {
          margin: 0;
        }
      
        h1, h2, h3, h4, h5, h6 {
          font-family: var(--font-heading);
        }
      
        ::selection {
          background-color: rgba(20, 184, 166, 0.2);
          color: inherit;
        }
      
        .dark ::selection {
          background-color: rgba(20, 184, 166, 0.3);
        }
      </style>
    
      <script>
        // Show/hide back to top button based on scroll position
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
          if (window.scrollY > 500) {
            backToTop.classList.remove('opacity-0');
            backToTop.classList.add('opacity-100');
          } else {
            backToTop.classList.remove('opacity-100');
            backToTop.classList.add('opacity-0');
          }
        });
      </script>

      <!-- Cloudflare Turnstile -->
      <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

      <!-- Brevo Form Scripts -->
      <script is:inline>
        // Turnstile/reCAPTCHA callback function
        window.handleCaptchaResponse = function(token) {
          console.log('Captcha completed:', token);

          // Set the token in the hidden input field that Brevo expects
          var tokenInput = document.getElementById('g-recaptcha-response');
          if (tokenInput) {
            tokenInput.value = token;
          }

          // Trigger the captchaChange event for Brevo
          var event = new Event('captchaChange');
          var captchaElement = document.getElementById('sib-captcha');
          if (captchaElement) {
            captchaElement.dataset.captchaToken = token;
            captchaElement.dispatchEvent(event);
          }

          // Also dispatch input event on the hidden field
          if (tokenInput) {
            var inputEvent = new Event('input', { bubbles: true });
            tokenInput.dispatchEvent(inputEvent);
          }
        };

        // Brevo form configuration (must be set before main.js loads)
        window.REQUIRED_CODE_ERROR_MESSAGE = 'Please choose a country code';
        window.LOCALE = 'en';
        window.EMAIL_INVALID_MESSAGE = window.SMS_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";
        window.REQUIRED_ERROR_MESSAGE = "Please complete the captcha verification.";
        window.GENERIC_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";
        window.translation = {
          common: {
            selectedList: '{quantity} list selected',
            selectedLists: '{quantity} lists selected',
            selectedOption: '{quantity} selected',
            selectedOptions: '{quantity} selected',
          }
        };
        window.AUTOHIDE = Boolean(0);

        // Load Brevo script only after DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadBrevoScript);
        } else {
          loadBrevoScript();
        }

        function loadBrevoScript() {
          // Check if the form exists before loading the script
          if (document.getElementById('sib-form')) {
            var script = document.createElement('script');
            script.src = 'https://sibforms.com/forms/end-form/build/main.js';
            script.defer = true;
            document.body.appendChild(script);
          }
        }
      </script>
    </body>
  </html>
